<main>
  <mat-expansion-panel hideToggle>
    <mat-expansion-panel-header>
      <mat-panel-title> Selecione ciclos (opcional) </mat-panel-title>
    </mat-expansion-panel-header>

    <div class="ciclos-container">
      <div class="section-header">
        Ciclos com entidades disponíveis ({{ getTotalCyclesWithEntities() }})
      </div>
      <table
        mat-table
        [dataSource]="this.eventsState.categorizedCycles().withEntities"
        class="mat-elevation-z0 ciclos-table"
      >
        <ng-container matColumnDef="selecionar">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let cycle">
            <mat-checkbox
              (change)="this.eventsState.onCheckboxChange( cycle)"
              [(ngModel)]="cycle.selecionado"
              [ngClass]="{
                'checked-active': cycle.ativo,
                'checkbox-faded': !cycle.ativo && !cycle.selecionado
              }"
            >
            </mat-checkbox>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let cycle">
            <mat-icon [style.color]="cycle.priority | iconColor" >arrow_upward</mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef>Ciclos</th>
          <td mat-cell *matCellDef="let cycle">{{ cycle.name }}</td>
        </ng-container>

        <ng-container matColumnDef="selecionadosDisponiveis">
          <th mat-header-cell *matHeaderCellDef class="align-right">
            Selecionados/Disponíveis
          </th>
          <td mat-cell *matCellDef="let cycle" class="align-right">
            {{ entitiesModelSignalValue }} / {{ cycle.availableEntities }}
          </td>
        </ng-container>

        <ng-container matColumnDef="eventosHoje">
          <th mat-header-cell *matHeaderCellDef class="align-right">
            Eventos para hoje
          </th>
          <td mat-cell *matCellDef="let cycle" class="align-right">
            <span *ngIf="!isNaN(cycle.structure.length)">{{
              this.getEventsForToday(cycle.structure)
            }}</span>
          </td>
        </ng-container>

        <tr
          mat-header-row
          *matHeaderRowDef="displayedColumnsComEntidades; sticky: true"
        ></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumnsComEntidades"
        ></tr>
      </table>
      <mat-divider></mat-divider>

      <div class="section-header section-header-margin">
        Ciclos sem entidades disponíveis ({{ getTotalCyclesWithoutEntities() }})
      </div>
      <table
        mat-table
        [dataSource]="this.eventsState.categorizedCycles().withoutEntities"
        class="mat-elevation-z0 ciclos-table"
      >
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let cycle">
            <mat-icon [style.color]="cycle.statusCor">{{
              cycle.statusIcone
            }}</mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="nome">
          <th mat-header-cell *matHeaderCellDef>Ciclos</th>
          <td mat-cell *matCellDef="let cycle"> {{ cycle.name }}</td>
        </ng-container>

        <ng-container matColumnDef="selecionadosDisponiveis">
          <th mat-header-cell *matHeaderCellDef class="align-right">
            Selecionados/Disponíveis
          </th>
          <td mat-cell *matCellDef="let cycle" class="align-right">
            {{ cycle.selecionadosDisponiveis }}
          </td>
        </ng-container>

        <ng-container matColumnDef="eventosHoje">
          <th mat-header-cell *matHeaderCellDef class="align-right">
            Eventos para hoje
          </th>
          <td mat-cell *matCellDef="let cycle" class="align-right">
            <span *ngIf="!isNaN(cycle.eventosHoje)">{{
              cycle.eventosHoje
            }}</span>
          </td>
        </ng-container>

        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumnsSemEntidades"
        ></tr>
      </table>
    </div>
  </mat-expansion-panel>
</main>
